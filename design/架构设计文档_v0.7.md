# AI Project Management Platform - 架构设计文档 v0.7

> **版本说明**：基于v0.7需求设计的系统架构和技术选型  
> **核心原则**：把优秀的人的工作经验以Skill方式用于项目各环节  
> **产品架构**：Web平台 + CLI客户端 + AI工具集成

---

## 一、核心架构理念

### 1.1 设计原则

```
核心原则：优秀的人的经验 → Skill → 用于项目各环节

设计优先级：
├─ 1. Skill是参与者的核心资产               → 经验封装，可复用
├─ 2. 参与者自由选择AI工具                 → Claude/Cursor/Codex
├─ 3. 平台只验收成果，不关心过程           → 只看交付件
├─ 4. Skill可集成到AI工具                 → 直接在AI中使用
└─ 5. 社区可复用优秀Skill                 → 经验沉淀和分享
```

### 1.2 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          整体架构                                         │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         Web平台层                                      │   │
│  │  ├─ 发起人：项目发布、验收管理、结算                              │   │
│  │  ├─ 参与者：任务大厅、个人档案、收益管理                          │   │
│  │  └─ 社区：Skill市场、技能评分、经验分享                          │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                      │
│                                    ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         CLI客户端层                                    │   │
│  │  ├─ 任务同步：从平台拉取任务到本地                                │   │
│  │  ├─ 成果提交：提交GitHub PR到平台                                │   │
│  │  ├─ 验收查看：查看发起人验收结果                                  │   │
│  │  └─ Skill管理：分享/导入Skill                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                      │
│                                    │                                      │
│              ┌────────────────────┼────────────────────┐              │
│              ▼                    ▼                    ▼              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │
│  │   Claude         │  │   Cursor        │  │   Codex/OpenCode│   │
│  │   (MCP集成)     │  │   (MCP集成)    │  │   (MCP集成)    │   │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘   │
│              │                    │                    │              │
│              └────────────────────┼────────────────────┘              │
│                                    ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         参与者工作流                                  │   │
│  │                                                                     │   │
│  │  1. 从CLI/平台拉取任务                                            │   │
│  │  2. 在AI工具中加载Skill（自己的/社区的）                          │   │
│  │  3. 用Skill完成项目（经验驱动）                                    │   │
│  │  4. 提交GitHub PR                                                │   │
│  │  5. 平台验收成果                                                  │   │
│  │  6. 获得分成                                                       │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                      │
│                                    ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         数据持久层 (Prisma)                          │   │
│  │  ├─ 用户/项目/任务/结算                                           │   │
│  │  └─ Skill市场数据（分享/评分/复用）                               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.3 核心角色与职责

| 角色 | 职责 | 核心资产 |
|------|------|----------|
| **发起人** | 发布项目、验收成果、支付分成 | 项目需求 |
| **参与者** | 用Skill完成项目、交付成果 | Skill（经验封装） |
| **平台** | 管理流程、验收标准、结算资金 | 流程和规则 |
| **社区** | 分享Skill、复用经验、沉淀知识 | Skill市场 |

---

## 二、Skill设计

### 2.1 Skill是什么

```
Skill定义：
├─ 是参与者的经验封装
├─ 包含：Prompt模板、工作流程、质量标准
├─ 可：复用、分享、集成到AI工具
└─ 用于：项目各环节

Skill不是：
├─ 不是平台提供的服务
├─ 不是调用API的封装
└─ 不是限制参与者工具
```

### 2.2 Skill核心组成

```typescript
interface Skill {
  // 基础信息
  id: string
  name: string                    // Skill名称
  description: string           // 功能描述
  author: User                   // 作者
  tags: string[]                // 标签：Python/React/API等
  
  // 核心组件
  promptTemplates: PromptTemplate[]  // Prompt模板集合
  workflow: Workflow              // 工作流程定义
  qualityStandard: QualityStandard // 质量标准
  
  // 元数据
  stats: {
    usageCount: number          // 使用次数
    successRate: number         // 验收通过率
    avgQualityScore: number      // 平均质量分
  }
  
  // 权限
  visibility: 'private' | 'community' | 'public'
  license: string               // 开源许可证
}
```

### 2.3 Skill示例

```
示例：Python RESTful API 开发Skill

Skill结构：
├─ 名称：Python RESTful API 开发专家
├─ 标签：[Python, FastAPI, RESTful, API Design]
├─ Prompt模板：
│  ├─ 基础模板：通用API开发Prompt
│  ├─ 数据库集成：SQLAlchemy集成模板
│  ├─ 认证模块：JWT认证模板
│  └─ 测试模板：pytest模板
├─ 工作流程：
│  ├─ 步骤1：分析API需求
│  ├─ 步骤2：设计数据模型
│  ├─ 步骤3：编写API代码
│  └─ 步骤4：编写测试用例
└─ 质量标准：
   ├─ PEP8规范
   ├─ 单元测试覆盖率 > 80%
   ├─ 错误处理完整
   └─ 文档齐全
```

### 2.4 Skill与AI工具集成

```
集成方式：MCP (Model Context Protocol)

参与者操作：
1. 在Claude Desktop中安装Skill
   └─ 直接加载Prompt模板

2. 在Cursor中导入Skill
   └─ 作为代码生成规则

3. 在OpenCode中集成Skill
   └─ 作为开发模板

效果：
参与者用习惯的工具
+ 加载优秀Skill
= 高质量产出
```

---

## 三、技术选型

### 3.1 最终技术栈

| 层级 | 技术选型 | 版本 | 选型理由 |
|------|----------|------|----------|
| **前端框架** | Vue 3 | 3.4+ | 学习成本低 |
| **前端语言** | TypeScript | 5.0+ | 类型安全 |
| **UI组件库** | Naive UI | 2.7+ | Vue生态友好 |
| **状态管理** | Pinia | 2.0+ | API简洁 |
| **后端框架** | Fastify | 4.0+ | 高性能 |
| **后端语言** | TypeScript | 5.0+ | 与前端统一 |
| **ORM** | Prisma | 5.0+ | 类型安全 |
| **数据库(开发)** | SQLite | 3.44+ | 免安装 |
| **数据库(生产)** | PostgreSQL | 15+ | 生产级 |
| **认证** | JWT | - | 简单无状态 |
| **部署** | Docker | 24+ | 一键部署 |
| **CLI工具** | Node.js + Commander.js | - | TypeScript统一 |
| **AI集成** | MCP Protocol | - | AI工具集成标准 |

### 2.5 CLI客户端设计

```
CLI客户端功能：
├─ 任务管理
│  ├─ aipm task list              # 列出可认领任务
│  ├─ aipm task claim <id>       # 认领任务
│  ├─ aipm task pull             # 同步任务到本地
│  └─ aipm task submit           # 提交成果
│
├─ Skill管理
│  ├─ aipm skill list            # 列出我的Skill
│  ├─ aipm skill create          # 创建Skill
│  ├─ aipm skill export <id>     # 导出为MCP格式
│  └─ aipm skill import <file>   # 导入Skill
│
├─ 项目管理
│  ├─ aipm project list          # 列出我的项目
│  └─ aipm project info <id>     # 项目详情
│
└─ 验收查询
   ├─ aipm review status         # 查看验收状态
   └─ aipm review result         # 查看验收结果

CLI工作流：
1. aipm task list                # 查看任务大厅
2. aipm task pull <id>           # 拉取任务到本地
3. 在AI工具中使用Skill完成交付    # Claude/Cursor/Codex
4. aipm task submit               # 提交GitHub PR
```

### 3.2 技术栈优势

| 优势 | 说明 |
|------|------|
| **TypeScript统一** | 前后端+CLI都是TS，降低认知负担 |
| **SQLite开发** | 免安装，秒启动，一人开发友好 |
| **Vue 3** | 学习成本低，文档友好 |
| **MCP集成** | 标准化AI工具集成 |
| **CLI优先** | 对开发者友好，浏览器兼容问题少 |

### 3.3 对比之前版本

| 维度 | v0.6 | v0.7 |
|------|-------|-------|
| **Skill定位** | 平台封装AI调用 | 参与者经验封装 |
| **参与者工具** | 通过Skill调用AI | 自由选择AI工具 |
| **平台职责** | 转发Skill调用 | 只验收成果 |
| **AI集成** | Direct SDK | MCP Protocol |
| **CLI作用** | 后期可选 | 本地对接工具 |

---

## 四、数据模型设计

### 4.1 核心数据表

#### 4.1.1 用户表 (users)

```typescript
model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  name          String
  avatar        String?
  role          Role      @default(PARTICIPANT)
  status        UserStatus @default(ACTIVE)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  skills        Skill[]   @relation("SkillAuthor")
  usedSkills    SkillUsage[]
  projects      Project[]  @relation("ProjectInitiator")
  tasks         Task[]
  settlements   Settlement[]
  
  @@map("users")
}

enum Role {
  INITIATOR    // 发起人
  PARTICIPANT  // 参与者
  ADMIN        // 管理员
}

enum UserStatus {
  ACTIVE
  INACTIVE
}
```

#### 4.1.2 Skill表 (skills)

```typescript
model Skill {
  id            String    @id @default(uuid())
  name          String
  description   String
  tags          String[]
  
  // Prompt模板
  promptTemplates Json    // 序列化存储
  
  // 工作流程定义
  workflow       Json
  
  // 质量标准
  qualityStandard Json
  
  // 元数据
  visibility     Visibility @default(COMMUNITY)
  license        String     @default("MIT")
  
  authorId       String
  author         User       @relation("SkillAuthor", fields: [authorId], references: [id])
  
  // 统计
  stats {
    usageCount:     Int       @default(0)
    successRate:    Float     @default(0)
    avgQualityScore: Float   @default(0)
  }
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  usages        SkillUsage[]
  
  @@map("skills")
}

enum Visibility {
  PRIVATE     // 仅自己可见
  COMMUNITY  // 社区可见
  PUBLIC     // 公开
}
```

#### 4.1.3 Skill使用记录表 (skill_usages)

```typescript
model SkillUsage {
  id            String    @id @default(uuid())
  skillId       String
  skill         Skill     @relation(fields: [skillId], references: [id])
  
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  
  taskId        String?
  task          Task?     @relation(fields: [taskId], references: [id])
  
  // 使用情况
  qualityScore   Float?    // 本次质量评分
  wasApproved    Boolean   @default(false)
  
  usedAt        DateTime  @default(now())
  
  @@map("skill_usages")
}

#### 4.1.5a 验收标准Skill表 (review_standards)

```typescript
model ReviewStandard {
  id            String    @id @default(uuid())
  name          String    // Skill名称
  authorId      String
  author        User      @relation(fields: [authorId], references: [id])
  
  // 类型
  type          ReviewStandardType @default(COMMUNITY)
  license       String    @default("MIT")
  repoUrl       String?   // 开源仓库地址
  
  // 验收标准
  criteria      Json      // 检查项列表
  weights       Float[]   // 各项权重
  minScore     Float     @default(4.0) // 最低通过分数
  
  // 自动化
  automation    AutomationLevel @default(MANUAL)
  autoTools    String[]  // 自动化工具
  
  // 统计
  usageCount   Int       @default(0)
  avgScore     Float?
  
  // 状态
  status        ReviewStandardStatus @default(DRAFT)
  isVerified    Boolean   @default(false) // 平台审核
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("review_standards")
}

enum ReviewStandardType {
  OFFICIAL    // 平台官方
  COMMUNITY   // 社区贡献
  CUSTOM      // 自定义
}

enum AutomationLevel {
  MANUAL      // 纯人工
  SEMI_AUTO   // 半自动
  AUTO        // 全自动
}

enum ReviewStandardStatus {
  DRAFT
  PUBLISHED
  DEPRECATED
}

#### 4.1.5b 项目验收标准关联表 (project_review_standards)

```typescript
model ProjectReviewStandard {
  id              String    @id @default(uuid())
  projectId       String
  project         Project   @relation(fields: [projectId], references: [id])
  
  reviewStandardId String
  reviewStandard  ReviewStandard @relation(fields: [reviewStandardId], references: [id])
  
  // 项目特定配置
  customCriteria  Json?     // 自定义检查项
  customWeights  Float[]   // 自定义权重
  
  // 环节关联
  milestoneIds    String[]  // 适用的环节ID列表
  
  createdAt       DateTime  @default(now())
  
  @@unique([projectId, reviewStandardId])
  @@map("project_review_standards")
}

#### 4.1.5c 验收记录表 (task_reviews)

```typescript
model TaskReview {
  id              String    @id @default(uuid())
  taskId          String
  task            Task      @relation(fields: [taskId], references: [id])
  
  reviewStandardId String
  reviewStandard  ReviewStandard @relation(fields: [reviewStandardId], references: [id])
  
  // 验收结果
  scores          Float[]   // 各项评分
  totalScore      Float     // 总分
  
  // 自动化检查结果
  autoCheckResults Json?    // 自动化工具检查结果
  
  // 人工评价
  reviewerId      String?   // 验收人（发起人或指定）
  comment         String?   // 评价说明
  
  // 验收操作
  result          ReviewResult
  requiresRevision Boolean  @default(false)
  revisionReason  String?
  
  createdAt       DateTime  @default(now())
  
  @@map("task_reviews")
}

enum ReviewResult {
  APPROVED
  REJECTED
  REVISION_REQUIRED
}

#### 4.1.7 信用历史记录表（核心：没有权威，只有历史）

```typescript
// 信用来源 = 历史记录总和
// 记录一旦写入不可修改，谁都看得见

// 4.1.7a 用户信用历史记录
model UserCreditHistory {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  
  // 信用类型
  creditType       CreditType
  
  // 信用变化
  change          Float     // 变化值（正/负）
  previousScore   Float     // 变化前分数
  newScore        Float     // 变化后分数
  
  // 来源
  sourceType      SourceType  // 来源类型
  sourceId        String?     // 来源ID（项目/Skill/验收标准等）
  sourceName      String?     // 来源名称（便于展示）
  
  // 附加信息
  description     String?     // 描述
  metadata        Json?       // 附加数据
  
  // 记录不可篡改
  createdAt       DateTime  @default(now())
  
  @@index([userId, creditType])
  @@map("user_credit_history")
}

enum CreditType {
  PARTICIPANT_CREDIT   // 参与者信用
  INITIATOR_CREDIT    // 发起人信用
  SKILL_CREDIT        // Skill信用
  REVIEW_STANDARD_CREDIT // 验收标准信用
}

enum SourceType {
  PROJECT_COMPLETED    // 项目完成
  TASK_APPROVED       // 任务验收通过
  TASK_REJECTED       // 任务验收拒绝
  GOOD_REVIEW         // 好评
  BAD_REVIEW          // 差评
  PUNISHMENT          // 惩罚
  REPORT              // 举报（对方被惩罚）
}

// 4.1.7b 用户当前信用快照（便于快速查询）
model UserCreditSnapshot {
  userId          String    @id @default(uuid())
  user            User      @relation(fields: [userId], references: [id])
  
  // 各维度信用
  participantScore Float     @default(0)  // 参与者信用
  initiatorScore  Float     @default(0)   // 发起人信用
  
  // 统计
  totalProjects   Int       @default(0)   // 参与项目数
  completedTasks  Int       @default(0)   // 完成任务数
  approvalRate    Float     @default(0)   // 验收通过率
  goodReviewRate  Float     @default(0)   // 好评率
  
  // 惩罚记录
  punishmentCount Int       @default(0)   // 被惩罚次数
  
  // 时间戳
  updatedAt      DateTime  @updatedAt
  
  @@map("user_credit_snapshots")
}

// 4.1.7c Skill信用历史记录
model SkillCreditHistory {
  id              String    @id @default(uuid())
  skillId         String
  
  // 信用变化
  change          Float
  previousScore   Float
  newScore        Float
  
  // 来源
  sourceType      SourceType
  sourceId        String?   // 使用该Skill的任务ID
  sourceName      String?   // 项目名称
  
  description     String?
  
  createdAt       DateTime  @default(now())
  
  @@index([skillId])
  @@map("skill_credit_history")
}

// 4.1.7d Skill信用快照
model SkillCreditSnapshot {
  skillId         String    @id
  
  // 统计
  usageCount      Int       @default(0)   // 使用次数
  approvalRate    Float     @default(0)   // 验收通过率
  goodReviewRate  Float     @default(0)   // 好评率
  averageScore    Float     @default(0)   // 平均评分
  
  updatedAt      DateTime  @updatedAt
  
  @@map("skill_credit_snapshots")
}

// 4.1.7e 社区治理记录（举证-惩罚机制）
model GovernanceRecord {
  id              String    @id @default(uuid())
  
  // 举报类型
  reportType      ReportType
  
  // 举报内容
  targetId        String    // 被举报人ID
  targetType      TargetType
  evidence        String    // 证据描述
  evidenceUrls    String[]  // 证据链接
  
  // 处理结果
  status          GovernanceStatus @default(PENDING)
  decision        String?   // 处理决定
  punishType      PunishType? // 惩罚类型
  punishDuration  Int?      // 惩罚时长（天）
  
  // 举证者
  reporterId      String
  
  // 社区投票
  supportVotes    Int       @default(0)   // 支持举报
  opposeVotes     Int       @default(0)   // 反对举报
  
  // 时间戳
  reportedAt      DateTime  @default(now())
  resolvedAt      DateTime?
  
  @@map("governance_records")
}

enum ReportType {
  FAKE_TRANSACTION   // 虚假交易
  PLAGIARISM        // 抄袭洗稿
  MALICIOUS_REVIEW  // 恶意差评
  FAKE_REVIEW       // 刷好评
  OTHER             // 其他
}

enum TargetType {
  USER
  SKILL
  REVIEW_STANDARD
}

enum GovernanceStatus {
  PENDING     // 待处理
  VOTING      // 投票中
  RESOLVED    // 已解决
  DISMISSED   // 驳回
}

enum PunishType {
  WARNING     // 警告
  FREEZE      // 冻结
  BAN         // 封禁
  PUBLIC_SHAME // 公开记录
}

#### 4.1.8 信用查询API

```typescript
// 查询用户的信用历史
GET /api/users/:id/credit-history

// 查询用户的信用快照
GET /api/users/:id/credit-snapshot

// 查询Skill的信用历史
GET /api/skills/:id/credit-history

// 查询Skill的信用快照
GET /api/skills/:id/credit-snapshot

// 查询治理记录
GET /api/governance?status=resolved

// 提交举报
POST /api/governance/report
```

#### 4.1.9 信用算法设计原则

```
信用计算原则：
├─ 时间衰减：越近的行为权重越高
├─ 成功溢价：完成项目权重 > 未完成
├─ 好评加成：好评 + 信用，差评 - 信用
├─ 惩罚倍增：一次作恶代价 >> 收益
└─ 多维度：数量、质量、好评率分开计算

具体公式：
├─ 参与者信用 = 完成率×40 + 质量分×40 + 好评率×20
├─ Skill信用 = 采用数×0.3 + 通过率×0.5 + 好评率×0.2
└─ 发起人信用 = 完成率×0.5 + 好评率×0.3 + 惩罚次数×-0.2
```

#### 4.1.10 历史记录不可篡改

```
实现方式：
├─ 所有记录写入后不可修改
├─ 所有记录公开透明
├─ 任何人都可以查询历史
└─ 信用由历史写就，没有权威

查询权限：
├─ 发起人可查参与者历史
├─ 参与者可查发起人历史
├─ 任何人可查Skill历史
└─ 任何人可查验收标准历史
```

#### 4.1.6 项目表 (projects)

#### 4.1.4 项目表 (projects)

```typescript
model Project {
  id            String    @id @default(uuid())
  title         String
  description   String
  mode          ProjectMode @default(COMMUNITY)
  visibility    Visibility @default(PUBLIC)
  status        ProjectStatus @default(DRAFT)
  
  totalBudget   Float
  costPerTask   Float?
  
  initiatorId   String
  initiator     User      @relation("ProjectInitiator", fields: [initiatorId], references: [id])
  
  milestones    Milestone[]
  tasks         Task[]
  settlements   Settlement[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("projects")
}

enum ProjectMode {
  COMMUNITY   // 现金
  ENTERPRISE  // 积分
}

enum Visibility {
  PUBLIC
  PRIVATE
}

enum ProjectStatus {
  DRAFT
  ACTIVE
  COMPLETED
  CANCELLED
}
```

#### 4.1.5 任务表 (tasks)

```typescript
model Task {
  id            String    @id @default(uuid())
  status        TaskStatus @default(PENDING)
  
  milestoneId   String
  milestone     Milestone  @relation(fields: [milestoneId], references: [id])
  
  assigneeId    String
  assignee      User       @relation(fields: [assigneeId], references: [id])
  
  // 参与者使用的Skill（记录）
  usedSkills    String[]  // Skill ID列表
  
  // 交付信息
  deliverableUrl String?   // GitHub PR/仓库URL
  qualityScore  Float?    // 验收评分
  
  // 时间戳
  startedAt      DateTime?
  submittedAt    DateTime?
  approvedAt     DateTime?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("tasks")
}

enum TaskStatus {
  PENDING      // 待认领
  IN_PROGRESS  // 进行中
  SUBMITTED    // 已提交
  APPROVED     // 已通过验收
  REJECTED     // 验收被拒
  CANCELLED     // 已取消
}
```

#### 4.1.6 结算表 (settlements)

```typescript
model Settlement {
  id            String    @id @default(uuid())
  projectId     String
  project       Project    @relation(fields: [projectId], references: [id])
  
  userId        String
  user          User       @relation(fields: [userId], references: [id])
  
  taskId        String?
  task          Task?      @relation(fields: [taskId], references: [id])
  
  amount        Float
  currency      String    @default("CNY")
  
  status        SettlementStatus @default(PENDING)
  
  settledAt     DateTime?
  createdAt     DateTime  @default(now())
  
  @@map("settlements")
}

enum SettlementStatus {
  PENDING
  COMPLETED
  FAILED

#### 4.1.11 初始信用评估表（解决冷启动）

```typescript
// 4.1.11a 初始信用Skill表
model InitialCreditSkill {
  id            String    @id @default(uuid())
  name          String    // Skill名称
  authorId      String
  author        User      @relation(fields: [authorId], references: [id])
  
  // 类型
  type          InitialCreditSkillType @default(COMMUNITY)
  license       String    @default("MIT")
  repoUrl       String?   // 开源仓库地址
  
  // 评价维度
  dimensions      Json      // 技能测试、作品集、同行评议等
  
  // 计算公式
  calculation    Json      // 初始分计算公式
  
  // 统计
  usageCount    Int       @default(0)
  avgInitialScore Float?
  
  // 状态
  status        InitialCreditSkillStatus @default(DRAFT)
  isVerified    Boolean   @default(false)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("initial_credit_skills")
}

enum InitialCreditSkillType {
  OFFICIAL
  COMMUNITY
}

enum InitialCreditSkillStatus {
  DRAFT
  PUBLISHED
  DEPRECATED
}

// 4.1.11b 用户初始信用记录
model UserInitialCredit {
  userId          String    @id
  user            User      @relation(fields: [userId], references: [id])
  skillId         String
  skill           InitialCreditSkill @relation(fields: [skillId], references: [id])
  
  skillTestScore  Float?    // 技能测试分数
  portfolioScore   Float?    // 作品集分数
  peerReviewScore  Float?    // 同行评议分数
  
  initialScore     Float     // 加权总分
  evaluatedAt     DateTime  @default(now())
  expiresAt       DateTime   // 过期时间（3-6个月）
  
  @@map("user_initial_credits")
}

// 4.1.11c 技能测试记录
model SkillTestResult {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  testType        String
  score           Float
  totalQuestions  Int
  correctAnswers  Int
  details         Json
  skillId         String
  createdAt       DateTime  @default(now())
  
  @@index([userId, testType])
  @@map("skill_test_results")
}

// 4.1.11d 作品集评估记录
model PortfolioEvaluation {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  portfolioUrl    String
  evaluationType  EvaluationType
  aiScore         Float?
  aiAnalysis      Json?
  manualReview    Boolean   @default(false)
  manualScore     Float?
  manualComment   String?
  reviewerId      String?
  skillId         String
  createdAt       DateTime  @default(now())
  
  @@map("portfolio_evaluations")
}

enum EvaluationType {
  AI_AUTO
  MANUAL
  HYBRID
}

// 4.1.11e 同行评议记录
model PeerReviewResult {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  reviewerId      String
  reviewer        User      @relation(fields: [reviewerId], references: [id])
  score           Float
  comment         String?
  reviewerMinCredit Float
  skillId         String
  createdAt       DateTime  @default(now())
  
  @@unique([userId, reviewerId, skillId])
  @@map("peer_review_results")
}

// 4.1.11f 最终信用计算
model UserFinalCredit {
  userId          String    @id
  user            User      @relation(fields: [userId], references: [id])
  initialScore     Float
  initialWeight    Float     @default(1.0)
  initialExpiresAt DateTime?
  longTermScore   Float
  finalScore      Float
  calculatedAt    DateTime  @default(now())
  
  @@map("user_final_credits")
}
```

#### 4.1.12 初始信用查询API

```typescript
GET /api/v1/users/:id/initial-credit
GET /api/v1/initial-credit-skills
POST /api/v1/users/:id/skill-test
POST /api/v1/users/:id/portfolio
GET /api/v1/users/:id/peer-reviews
GET /api/v1/users/:id/final-credit
```

#### 4.1.13 初始信用计算公式示例

```typescript
// @ai-pm/initial-credit 官方初始信用Skill
const officialInitialCreditSkill = {
  name: "@ai-pm/initial-credit",
  dimensions: {
    skillTest: { weight: 0.4, testTypes: ["python", "javascript"] },
    portfolio: { weight: 0.4, evaluationType: "AI_AUTO" },
    peerReview: { weight: 0.2, minReviewerCredit: 100 }
  },
  calculateInitialScore: (scores) => {
    return scores.skillTestScore * 0.4 + scores.portfolioScore * 0.4 + scores.peerReviewScore * 0.2
  }
}

// 最终信用计算（初始信用随时间衰减）
const calculateFinalCredit = (initialScore, longTermScore, months) => {
  const initialWeight = Math.max(1.0 - (months - 3) * 0.1, 0.1)
  return initialScore * initialWeight + longTermScore * (1.0 - initialWeight)
}
```

