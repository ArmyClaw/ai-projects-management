# AI Project Management Platform - 架构设计文档 v0.7

> **版本说明**：基于v0.7需求设计的系统架构和技术选型  
> **核心原则**：把优秀的人的工作经验以Skill方式用于项目各环节  
> **产品架构**：Web平台 + CLI客户端 + AI工具集成

---

## 一、核心架构理念

### 1.1 设计原则

```
核心原则：优秀的人的经验 → Skill → 用于项目各环节

设计优先级：
├─ 1. Skill是参与者的核心资产               → 经验封装，可复用
├─ 2. 参与者自由选择AI工具                 → Claude/Cursor/Codex
├─ 3. 平台只验收成果，不关心过程           → 只看交付件
├─ 4. Skill可集成到AI工具                 → 直接在AI中使用
└─ 5. 社区可复用优秀Skill                 → 经验沉淀和分享
```

### 1.2 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          整体架构                                         │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         Web平台层                                      │   │
│  │  ├─ 发起人：项目发布、验收管理、结算                              │   │
│  │  ├─ 参与者：任务大厅、个人档案、收益管理                          │   │
│  │  └─ 社区：Skill市场、技能评分、经验分享                          │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                      │
│                                    ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         CLI客户端层                                    │   │
│  │  ├─ 任务同步：从平台拉取任务到本地                                │   │
│  │  ├─ 成果提交：提交GitHub PR到平台                                │   │
│  │  ├─ 验收查看：查看发起人验收结果                                  │   │
│  │  └─ Skill管理：分享/导入Skill                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                      │
│                                    │                                      │
│              ┌────────────────────┼────────────────────┐              │
│              ▼                    ▼                    ▼              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │
│  │   Claude         │  │   Cursor        │  │   Codex/OpenCode│   │
│  │   (MCP集成)     │  │   (MCP集成)    │  │   (MCP集成)    │   │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘   │
│              │                    │                    │              │
│              └────────────────────┼────────────────────┘              │
│                                    ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         参与者工作流                                  │   │
│  │                                                                     │   │
│  │  1. 从CLI/平台拉取任务                                            │   │
│  │  2. 在AI工具中加载Skill（自己的/社区的）                          │   │
│  │  3. 用Skill完成项目（经验驱动）                                    │   │
│  │  4. 提交GitHub PR                                                │   │
│  │  5. 平台验收成果                                                  │   │
│  │  6. 获得分成                                                       │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                      │
│                                    ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         数据持久层 (Prisma)                          │   │
│  │  ├─ 用户/项目/任务/结算                                           │   │
│  │  └─ Skill市场数据（分享/评分/复用）                               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.3 核心角色与职责

| 角色 | 职责 | 核心资产 |
|------|------|----------|
| **发起人** | 发布项目、验收成果、支付分成 | 项目需求 |
| **参与者** | 用Skill完成项目、交付成果 | Skill（经验封装） |
| **平台** | 管理流程、验收标准、结算资金 | 流程和规则 |
| **社区** | 分享Skill、复用经验、沉淀知识 | Skill市场 |

---

## 二、Skill设计

### 2.1 Skill是什么

```
Skill定义：
├─ 是参与者的经验封装
├─ 包含：Prompt模板、工作流程、质量标准
├─ 可：复用、分享、集成到AI工具
└─ 用于：项目各环节

Skill不是：
├─ 不是平台提供的服务
├─ 不是调用API的封装
└─ 不是限制参与者工具
```

### 2.2 Skill核心组成

```typescript
interface Skill {
  // 基础信息
  id: string
  name: string                    // Skill名称
  description: string           // 功能描述
  author: User                   // 作者
  tags: string[]                // 标签：Python/React/API等
  
  // 核心组件
  promptTemplates: PromptTemplate[]  // Prompt模板集合
  workflow: Workflow              // 工作流程定义
  qualityStandard: QualityStandard // 质量标准
  
  // 元数据
  stats: {
    usageCount: number          // 使用次数
    successRate: number         // 验收通过率
    avgQualityScore: number      // 平均质量分
  }
  
  // 权限
  visibility: 'private' | 'community' | 'public'
  license: string               // 开源许可证
}
```

### 2.3 Skill示例

```
示例：Python RESTful API 开发Skill

Skill结构：
├─ 名称：Python RESTful API 开发专家
├─ 标签：[Python, FastAPI, RESTful, API Design]
├─ Prompt模板：
│  ├─ 基础模板：通用API开发Prompt
│  ├─ 数据库集成：SQLAlchemy集成模板
│  ├─ 认证模块：JWT认证模板
│  └─ 测试模板：pytest模板
├─ 工作流程：
│  ├─ 步骤1：分析API需求
│  ├─ 步骤2：设计数据模型
│  ├─ 步骤3：编写API代码
│  └─ 步骤4：编写测试用例
└─ 质量标准：
   ├─ PEP8规范
   ├─ 单元测试覆盖率 > 80%
   ├─ 错误处理完整
   └─ 文档齐全
```

### 2.4 Skill与AI工具集成

```
集成方式：MCP (Model Context Protocol)

参与者操作：
1. 在Claude Desktop中安装Skill
   └─ 直接加载Prompt模板

2. 在Cursor中导入Skill
   └─ 作为代码生成规则

3. 在OpenCode中集成Skill
   └─ 作为开发模板

效果：
参与者用习惯的工具
+ 加载优秀Skill
= 高质量产出
```

---

## 三、技术选型

### 3.1 最终技术栈

| 层级 | 技术选型 | 版本 | 选型理由 |
|------|----------|------|----------|
| **前端框架** | Vue 3 | 3.4+ | 学习成本低 |
| **前端语言** | TypeScript | 5.0+ | 类型安全 |
| **UI组件库** | Naive UI | 2.7+ | Vue生态友好 |
| **状态管理** | Pinia | 2.0+ | API简洁 |
| **后端框架** | Fastify | 4.0+ | 高性能 |
| **后端语言** | TypeScript | 5.0+ | 与前端统一 |
| **ORM** | Prisma | 5.0+ | 类型安全 |
| **数据库(开发)** | SQLite | 3.44+ | 免安装 |
| **数据库(生产)** | PostgreSQL | 15+ | 生产级 |
| **认证** | JWT | - | 简单无状态 |
| **部署** | Docker | 24+ | 一键部署 |
| **CLI工具** | Node.js + Commander.js | - | TypeScript统一 |
| **AI集成** | MCP Protocol | - | AI工具集成标准 |

### 2.5 CLI客户端设计

```
CLI客户端功能：
├─ 任务管理
│  ├─ aipm task list              # 列出可认领任务
│  ├─ aipm task claim <id>       # 认领任务
│  ├─ aipm task pull             # 同步任务到本地
│  └─ aipm task submit           # 提交成果
│
├─ Skill管理
│  ├─ aipm skill list            # 列出我的Skill
│  ├─ aipm skill create          # 创建Skill
│  ├─ aipm skill export <id>     # 导出为MCP格式
│  └─ aipm skill import <file>   # 导入Skill
│
├─ 项目管理
│  ├─ aipm project list          # 列出我的项目
│  └─ aipm project info <id>     # 项目详情
│
└─ 验收查询
   ├─ aipm review status         # 查看验收状态
   └─ aipm review result         # 查看验收结果

CLI工作流：
1. aipm task list                # 查看任务大厅
2. aipm task pull <id>           # 拉取任务到本地
3. 在AI工具中使用Skill完成交付    # Claude/Cursor/Codex
4. aipm task submit               # 提交GitHub PR
```

### 3.2 技术栈优势

| 优势 | 说明 |
|------|------|
| **TypeScript统一** | 前后端+CLI都是TS，降低认知负担 |
| **SQLite开发** | 免安装，秒启动，一人开发友好 |
| **Vue 3** | 学习成本低，文档友好 |
| **MCP集成** | 标准化AI工具集成 |
| **CLI优先** | 对开发者友好，浏览器兼容问题少 |

### 3.3 对比之前版本

| 维度 | v0.6 | v0.7 |
|------|-------|-------|
| **Skill定位** | 平台封装AI调用 | 参与者经验封装 |
| **参与者工具** | 通过Skill调用AI | 自由选择AI工具 |
| **平台职责** | 转发Skill调用 | 只验收成果 |
| **AI集成** | Direct SDK | MCP Protocol |
| **CLI作用** | 后期可选 | 本地对接工具 |

---

## 四、数据模型设计

### 4.1 核心数据表

#### 4.1.1 用户表 (users)

```typescript
model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  name          String
  avatar        String?
  role          Role      @default(PARTICIPANT)
  status        UserStatus @default(ACTIVE)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  skills        Skill[]   @relation("SkillAuthor")
  usedSkills    SkillUsage[]
  projects      Project[]  @relation("ProjectInitiator")
  tasks         Task[]
  settlements   Settlement[]
  
  @@map("users")
}

enum Role {
  INITIATOR    // 发起人
  PARTICIPANT  // 参与者
  ADMIN        // 管理员
}

enum UserStatus {
  ACTIVE
  INACTIVE
}
```

#### 4.1.2 Skill表 (skills)

```typescript
model Skill {
  id            String    @id @default(uuid())
  name          String
  description   String
  tags          String[]
  
  // Prompt模板
  promptTemplates Json    // 序列化存储
  
  // 工作流程定义
  workflow       Json
  
  // 质量标准
  qualityStandard Json
  
  // 元数据
  visibility     Visibility @default(COMMUNITY)
  license        String     @default("MIT")
  
  authorId       String
  author         User       @relation("SkillAuthor", fields: [authorId], references: [id])
  
  // 统计
  stats {
    usageCount:     Int       @default(0)
    successRate:    Float     @default(0)
    avgQualityScore: Float   @default(0)
  }
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  usages        SkillUsage[]
  
  @@map("skills")
}

enum Visibility {
  PRIVATE     // 仅自己可见
  COMMUNITY  // 社区可见
  PUBLIC     // 公开
}
```

#### 4.1.3 Skill使用记录表 (skill_usages)

```typescript
model SkillUsage {
  id            String    @id @default(uuid())
  skillId       String
  skill         Skill     @relation(fields: [skillId], references: [id])
  
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  
  taskId        String?
  task          Task?     @relation(fields: [taskId], references: [id])
  
  // 使用情况
  qualityScore   Float?    // 本次质量评分
  wasApproved    Boolean   @default(false)
  
  usedAt        DateTime  @default(now())
  
  @@map("skill_usages")
}
```

#### 4.1.4 项目表 (projects)

```typescript
model Project {
  id            String    @id @default(uuid())
  title         String
  description   String
  mode          ProjectMode @default(COMMUNITY)
  visibility    Visibility @default(PUBLIC)
  status        ProjectStatus @default(DRAFT)
  
  totalBudget   Float
  costPerTask   Float?
  
  initiatorId   String
  initiator     User      @relation("ProjectInitiator", fields: [initiatorId], references: [id])
  
  milestones    Milestone[]
  tasks         Task[]
  settlements   Settlement[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("projects")
}

enum ProjectMode {
  COMMUNITY   // 现金
  ENTERPRISE  // 积分
}

enum Visibility {
  PUBLIC
  PRIVATE
}

enum ProjectStatus {
  DRAFT
  ACTIVE
  COMPLETED
  CANCELLED
}
```

#### 4.1.5 任务表 (tasks)

```typescript
model Task {
  id            String    @id @default(uuid())
  status        TaskStatus @default(PENDING)
  
  milestoneId   String
  milestone     Milestone  @relation(fields: [milestoneId], references: [id])
  
  assigneeId    String
  assignee      User       @relation(fields: [assigneeId], references: [id])
  
  // 参与者使用的Skill（记录）
  usedSkills    String[]  // Skill ID列表
  
  // 交付信息
  deliverableUrl String?   // GitHub PR/仓库URL
  qualityScore  Float?    // 验收评分
  
  // 时间戳
  startedAt      DateTime?
  submittedAt    DateTime?
  approvedAt     DateTime?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("tasks")
}

enum TaskStatus {
  PENDING      // 待认领
  IN_PROGRESS  // 进行中
  SUBMITTED    // 已提交
  APPROVED     // 已通过验收
  REJECTED     // 验收被拒
  CANCELLED     // 已取消
}
```

#### 4.1.6 结算表 (settlements)

```typescript
model Settlement {
  id            String    @id @default(uuid())
  projectId     String
  project       Project    @relation(fields: [projectId], references: [id])
  
  userId        String
  user          User       @relation(fields: [userId], references: [id])
  
  taskId        String?
  task          Task?      @relation(fields: [taskId], references: [id])
  
  amount        Float
  currency      String    @default("CNY")
  
  status        SettlementStatus @default(PENDING)
  
  settledAt     DateTime?
  createdAt     DateTime  @default(now())
  
  @@map("settlements")
}

enum SettlementStatus {
  PENDING
  COMPLETED
  FAILED
}
```

---

## 五、API设计

### 5.1 API端点清单

#### Skill模块 (/api/v1/skills)

| 方法 | 端点 | 描述 | 权限 |
|------|------|------|------|
| POST | /api/v1/skills | 创建Skill | 登录用户 |
| GET | /api/v1/skills | 获取Skill列表 | 公开 |
| GET | /api/v1/skills/:id | 获取Skill详情 | 公开 |
| PUT | /api/v1/skills/:id | 更新Skill | 作者 |
| DELETE | /api/v1/skills/:id | 删除Skill | 作者 |
| POST | /api/v1/skills/:id/publish | 发布到社区 | 作者 |
| POST | /api/v1/skills/:id/import | 导入Skill | 登录用户 |
| GET | /api/v1/skills/:id/export | 导出Skill (MCP格式) | 公开 |

#### 任务模块 (/api/v1/tasks)

| 方法 | 端点 | 描述 | 权限 |
|------|------|------|------|
| GET | /api/v1/tasks | 任务大厅 | 登录用户 |
| GET | /api/v1/tasks/my | 我的任务 | 登录用户 |
| POST | /api/v1/tasks/:id/claim | 认领任务 | 登录用户 |
| GET | /api/v1/tasks/:id | 任务详情 | 参与者 |
| POST | /api/v1/tasks/:id/submit | 提交成果 | 参与者 |
| POST | /api/v1/tasks/:id/review | 验收任务 | 发起人 |

#### CLI专用 (/api/v1/cli)

| 方法 | 端点 | 描述 |
|------|------|------|
| GET | /api/v1/cli/sync | 同步任务到本地 |
| POST | /api/v1/cli/notify | 接收GitHub Webhook |
| GET | /api/v1/cli/export-skill | 导出Skill为MCP格式 |

---

## 六、CLI客户端设计

### 6.1 CLI功能

```bash
# 任务管理
aipm task list              # 列出可认领任务
aipm task claim <id>      # 认领任务
aipm task pull             # 同步任务到本地
aipm task submit           # 提交成果

# Skill管理
aipm skill list            # 列出我的Skill
aipm skill create          # 创建Skill
aipm skill export <id>     # 导出为MCP格式
aipm skill import <file>    # 导入Skill

# 项目管理
aipm project list          # 列出我的项目
aipm project info <id>     # 项目详情

# 验收查询
aipm review status         # 查看验收状态
aipm review result         # 查看验收结果
```

### 6.2 CLI与平台交互

```
CLI工作流：

1. 登录认证
   aipm login → 获取JWT Token

2. 同步任务
   aipm task pull → 从平台拉取任务详情

3. 本地开发
   # 用Claude/Cursor/Codex开发
   # 加载Skill（自己的/社区的）

4. 提交成果
   aipm task submit --pr=<GitHub PR URL>
   → 通知平台：任务已提交

5. 验收结果
   aipm review result
   → 查看发起人验收结果
```

### 6.3 Skill导出为MCP格式

```
Skill导出结构：
{
  "name": "skill-name",
  "description": "...",
  "prompts": [
    {
      "name": "prompt-name",
      "template": "You are an expert in..."
    }
  ],
  "workflow": [
    {"step": 1, "description": "..."}
  ],
  "qualityStandard": {...}
}

在Claude Desktop中使用：
1. 导出为JSON
2. 复制到Claude的MCP配置目录
3. 自动加载到上下文中
```

---

## 七、部署架构

### 7.1 开发环境

```
本地开发：
├─ 前端：Vue 3 (localhost:3000)
├─ 后端：Fastify (localhost:3001)
└─ 数据库：SQLite文件
```

### 7.2 生产环境

```
生产部署：
┌─────────────────────────────────────────────────────────────┐
│                   Docker Compose                              │
│   ├─ api (Fastify):3001                                   │
│   ├─ web (Vue Build):80                                  │
│   ├─ db (PostgreSQL):5432                                │
│   └─ redis (可选):6379                                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 八、开发计划

### 8.1 MVP阶段（核心功能）

| 阶段 | 功能 | 时间 |
|------|------|------|
| **Phase 1** | 环境搭建 + 用户系统 | 1周 |
| **Phase 2** | 项目发布 + 任务大厅 | 1周 |
| **Phase 3** | 任务认领 + 成果提交 | 1周 |
| **Phase 4** | 发起人验收 + 结算 | 1周 |
| **Phase 5** | CLI客户端 | 1周 |

### 8.2 MVP功能清单

```
MVP功能（P0必须）：

用户系统：
├─ 注册/登录
├─ 个人档案
└─ Skill管理

项目管理：
├─ 发布项目
├─ 项目列表
└─ 项目详情

任务系统：
├─ 任务大厅
├─ 任务认领
├─ 成果提交
└─ 发起人验收

结算系统：
├─ 验收后结算
└─ 分成计算

CLI客户端：
├─ 任务同步
├─ 成果提交
└─ Skill导入/导出

P1可选：
├─ Skill市场
├─ Skill评分
└─ MCP集成
```

---

## 九、目录结构

```
ai-project-management/
├── api/                    # 后端源码
│   ├── src/
│   │   ├── entities/     # 数据实体
│   │   ├── repositories/ # 数据访问
│   │   ├── services/    # 业务逻辑
│   │   ├── routes/      # 路由
│   │   ├── middlewares/ # 中间件
│   │   └── utils/       # 工具
│   ├── prisma/          # ORM配置
│   └── package.json
│
├── web/                    # 前端源码
│   ├── src/
│   │   ├── views/       # 页面
│   │   ├── components/  # 组件
│   │   ├── stores/      # Pinia
│   │   └── utils/       # 工具
│   └── package.json
│
├── cli/                     # CLI客户端 ⭐
│   ├── src/
│   │   ├── commands/    # 命令实现
│   │   ├── services/    # 服务层
│   │   └── utils/       # 工具
│   └── package.json
│
├── docker-compose.yml
├── README.md
└── IMPLEMENTATION_PLAN.md
```

---

**文档版本**: v0.7
**更新日期**: 2026-02-18
**核心原则**：优秀的人的经验以Skill方式用于项目各环节
